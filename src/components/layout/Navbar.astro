---
// Navbar.astro - Final Version with improved public site navigation
// All styles are in src/styles/globals.css
---

<nav id="main-navbar" class="main-navbar">
    <div class="container navbar-inner-content">
        <a href="/" id="logo-link" class="navbar-logo-button" aria-label="Divinex Home">
            <i class="fa-solid fa-palette navbar-logo-icon"></i>
            <span class="navbar-logo-text">Divinex Agency</span>
        </a>

        <div class="navbar-desktop-links">
            <a class="navbar-link" href="#home">Home</a>
            <a class="navbar-link" href="#services">Services</a>
            <a class="navbar-link" href="#portfolio">Portfolio</a>
            <a class="navbar-link" href="#about">About</a>
            <a class="navbar-link" href="#contact">Contact</a>
            <a href="/admin/login" class="navbar-admin-btn">Admin Login</a>
        </div>

        <button id="mobile-menu-toggle" class="navbar-mobile-toggle" aria-label="Toggle menu">
            <i class="fa-solid fa-bars mobile-menu-icon-open" id="mobile-menu-icon-open"></i>
            <i class="fa-solid fa-xmark mobile-menu-icon-close" id="mobile-menu-icon-close" style="display: none;"></i>
        </button>
    </div>

    <div id="mobile-menu-dropdown" class="navbar-mobile-dropdown">
        <div class="container navbar-mobile-links">
            <a class="navbar-link-mobile" href="#home">Home</a>
            <a class="navbar-link-mobile" href="#services">Services</a>
            <a class="navbar-link-mobile" href="#portfolio">Portfolio</a>
            <a class="navbar-link-mobile" href="#about">About</a>
            <a class="navbar-link-mobile" href="#contact">Contact</a>
            <a href="/admin/login" class="navbar-admin-btn-mobile">Admin Login</a>
        </div>
    </div>
</nav>

<script>
    (function() {
        const initNavbar = () => {
            const navbar = document.getElementById('main-navbar');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenuDropdown = document.getElementById('mobile-menu-dropdown');
            const mobileMenuIconOpen = document.getElementById('mobile-menu-icon-open');
            const mobileMenuIconClose = document.getElementById('mobile-menu-icon-close');
            const logoLink = document.getElementById('logo-link');

            if (!navbar || !mobileMenuToggle || !mobileMenuDropdown || !mobileMenuIconOpen || !mobileMenuIconClose || !logoLink) {
                console.warn('Navbar elements not found, skipping Navbar script initialization.');
                return;
            }

            let isMobileMenuOpen = false;
            let isScrolled = false;

            const handleScroll = () => {
                if (window.scrollY > 50 && !isScrolled) {
                    navbar.classList.add('scrolled');
                    isScrolled = true;
                } else if (window.scrollY <= 50 && isScrolled) {
                    navbar.classList.remove('scrolled');
                    isScrolled = false;
                }
            };

            const toggleMobileMenu = () => {
                isMobileMenuOpen = !isMobileMenuOpen;
                if (isMobileMenuOpen) {
                    mobileMenuDropdown.style.display = 'block';
                    mobileMenuIconOpen.style.display = 'none';
                    mobileMenuIconClose.style.display = 'block';
                } else {
                    mobileMenuDropdown.style.display = 'none';
                    mobileMenuIconOpen.style.display = 'block';
                    mobileMenuIconClose.style.display = 'none';
                }
            };

            const handleAnchorClick = (event: Event) => {
                const target = event.currentTarget as HTMLAnchorElement;
                const href = target.getAttribute('href');
                if (href && href.startsWith('#')) {
                    event.preventDefault();
                    const element = document.querySelector(href);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        console.warn(`Element with ID "${href.substring(1)}" not found for scrolling.`);
                    }
                    if (isMobileMenuOpen) toggleMobileMenu();
                } else if (isMobileMenuOpen) {
                    // For external links or /admin/login link, allow default behavior but close menu
                    toggleMobileMenu();
                }
            };

            // Remove any existing listeners to prevent duplicates on re-renders if any
            window.removeEventListener('scroll', handleScroll);
            mobileMenuToggle.removeEventListener('click', toggleMobileMenu);

            // Add listeners
            window.addEventListener('scroll', handleScroll);
            mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            
            // Logo link handler for public/admin navigation
            logoLink.addEventListener('click', (event) => {
                if (window.location.pathname.startsWith('/admin')) {
                    // If currently on an admin page, force full navigation to homepage
                    window.location.href = '/'; 
                    event.preventDefault(); // Prevent default anchor behavior
                } else {
                    // If on a public page, handle as an anchor scroll
                    handleAnchorClick(event);
                }
            });

            document.querySelectorAll('.navbar-desktop-links .navbar-link, .navbar-mobile-links .navbar-link-mobile').forEach(link => {
                link.addEventListener('click', handleAnchorClick);
            });

            // For admin login/logout, just close menu if on mobile. Allows default navigation.
            document.querySelectorAll('.navbar-admin-btn, .navbar-admin-btn-mobile').forEach(link => {
                link.addEventListener('click', (event) => {
                    // For anchor tags, let default navigation happen, but close mobile menu
                    if (isMobileMenuOpen) toggleMobileMenu();
                });
            });

            // Initial state
            handleScroll();
            mobileMenuDropdown.style.display = 'none';
            if (window.innerWidth < 768) {
                mobileMenuIconOpen.style.display = 'block';
                mobileMenuIconClose.style.display = 'none';
            } else {
                mobileMenuIconOpen.style.display = 'none';
                mobileMenuIconClose.style.display = 'none';
            }
        };

        document.addEventListener('astro:page-load', initNavbar);
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initNavbar();
        }
    })();
</script>