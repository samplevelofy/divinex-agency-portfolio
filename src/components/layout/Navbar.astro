---
// Navbar.astro
// All styles for this component are now in src/styles/globals.css
---

<nav id="main-navbar" class="main-navbar">
    <div class="container navbar-inner-content">
        <button id="logo-button" class="navbar-logo-button" aria-label="Home">
            <i class="fa-solid fa-palette navbar-logo-icon"></i>
            <span class="navbar-logo-text">Divinex Agency</span>
        </button>

        <div class="navbar-desktop-links">
            <button class="navbar-link" data-href="#home">Home</button>
            <button class="navbar-link" data-href="#services">Services</button>
            <button class="navbar-link" data-href="#portfolio">Portfolio</button>
            <button class="navbar-link" data-href="#about">About</button>
            <button class="navbar-link" data-href="#contact">Contact</button>
            <a href="/admin/login" class="navbar-admin-btn">Admin Login</a>
        </div>

        <button id="mobile-menu-toggle" class="navbar-mobile-toggle" aria-label="Toggle menu">
            <i class="fa-solid fa-bars mobile-menu-icon-open" id="mobile-menu-icon-open"></i>
            <i class="fa-solid fa-xmark mobile-menu-icon-close" id="mobile-menu-icon-close" style="display: none;"></i>
        </button>
    </div>

    <div id="mobile-menu-dropdown" class="navbar-mobile-dropdown">
        <div class="container navbar-mobile-links">
            <button class="navbar-link-mobile" data-href="#home">Home</button>
            <button class="navbar-link-mobile" data-href="#services">Services</button>
            <button class="navbar-link-mobile" data-href="#portfolio">Portfolio</button>
            <button class="navbar-link-mobile" data-href="#about">About</button>
            <button class="navbar-link-mobile" data-href="#contact">Contact</button>
            <a href="/admin/login" class="navbar-admin-btn-mobile">Admin Login</a>
        </div>
    </div>
</nav>

<script>
    // Using a self-executing function to avoid global scope pollution if multiple scripts run
    (function() {
        const initNavbar = () => {
            const navbar = document.getElementById('main-navbar');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenuDropdown = document.getElementById('mobile-menu-dropdown');
            const mobileMenuIconOpen = document.getElementById('mobile-menu-icon-open');
            const mobileMenuIconClose = document.getElementById('mobile-menu-icon-close');
            const logoButton = document.getElementById('logo-button');

            // Defensive check for element existence
            if (!navbar || !mobileMenuToggle || !mobileMenuDropdown || !mobileMenuIconOpen || !mobileMenuIconClose || !logoButton) {
                console.warn('Navbar elements not found, skipping Navbar script initialization.');
                return;
            }

            let isMobileMenuOpen = false;
            let isScrolled = false;

            const handleScroll = () => {
                if (window.scrollY > 50 && !isScrolled) {
                    navbar.classList.add('scrolled');
                    isScrolled = true;
                } else if (window.scrollY <= 50 && isScrolled) {
                    navbar.classList.remove('scrolled');
                    isScrolled = false;
                }
            };

            const toggleMobileMenu = () => {
                isMobileMenuOpen = !isMobileMenuOpen;
                if (isMobileMenuOpen) {
                    mobileMenuDropdown.style.display = 'block';
                    mobileMenuIconOpen.style.display = 'none';
                    mobileMenuIconClose.style.display = 'block';
                } else {
                    mobileMenuDropdown.style.display = 'none';
                    mobileMenuIconOpen.style.display = 'block';
                    mobileMenuIconClose.style.display = 'none';
                }
            };

            const scrollToSection = (event: Event) => {
                const target = event.currentTarget as HTMLElement;
                const href = target.dataset.href;
                if (href) {
                    const element = document.querySelector(href);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    }
                    if (isMobileMenuOpen) toggleMobileMenu();
                }
            };

            // Remove any existing listeners to prevent duplicates on re-renders if any
            window.removeEventListener('scroll', handleScroll);
            mobileMenuToggle.removeEventListener('click', toggleMobileMenu);

            // Add listeners
            window.addEventListener('scroll', handleScroll);
            mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            logoButton.addEventListener('click', (event) => {
                 // Explicitly prevent default if this is a button
                 if (event instanceof MouseEvent) event.preventDefault();
                 const home = document.querySelector('#home');
                 if (home) home.scrollIntoView({ behavior: 'smooth' });
                 if (isMobileMenuOpen) toggleMobileMenu();
            });

            document.querySelectorAll('.navbar-link, .navbar-link-mobile').forEach(link => {
                link.addEventListener('click', scrollToSection);
            });

            // Ensure admin link also closes mobile menu if open
            document.querySelectorAll('.navbar-admin-btn, .navbar-admin-btn-mobile').forEach(link => {
                link.addEventListener('click', () => {
                    if (isMobileMenuOpen) toggleMobileMenu();
                });
            });

            // Initial state
            handleScroll();
            mobileMenuDropdown.style.display = 'none';
            mobileMenuIconOpen.style.display = 'block';
            mobileMenuIconClose.style.display = 'none';
        };

        // Run on initial load and subsequent Astro page navigations
        document.addEventListener('astro:page-load', initNavbar);
        // Also run immediately in case astro:page-load already fired (for SSR or fast loads)
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initNavbar();
        }
    })();
</script>